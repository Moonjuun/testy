---
alwaysApply: true
---

# Secure Server Fetching Rules (Network Tab Stealth)

이 규칙은 **"API 호출 내역과 민감한 비즈니스 로직을 브라우저 네트워크 탭에 노출하지 않는 것"**을 최우선 목표로 한다.
모든 데이터 처리는 서버 내부에서 완료되어야 하며, 클라이언트는 결과만 수신해야 한다.

## 1. 기본 원칙 (Core Principles)

1.  **Client-Side Fetching 금지 (Sensitive Data):**
    - 민감한 데이터나 로직이 포함된 경우, 클라이언트 컴포넌트(`use client`) 내부에서 `fetch`, `axios`, `useQuery` 사용을 금지한다.
    - 이유: 브라우저 네트워크 탭에 API 엔드포인트와 응답 JSON이 그대로 노출됨.
2.  **Server Component First:**
    - 모든 데이터 조회(Read)는 **Server Component** (`async function`)에서 직접 수행한다.
    - DB 연결 및 외부 API 호출은 서버 내부에서 이루어지므로 브라우저는 알 수 없다.
3.  **Data Minimization (RSC Payload 보호):**
    - Server Component에서 Client Component로 데이터를 넘길 때(props), **필요한 최소한의 데이터만 가공하여** 넘긴다.
    - 이유: Next.js는 `props` 데이터를 직렬화하여 브라우저로 보낸다(`_rsc` 요청). 전체 DB 객체를 넘기면 네트워크 탭에서 내용을 볼 수 있다.

## 2. Supabase 데이터 조회 패턴

### ❌ Bad (네트워크 탭 노출됨)

클라이언트에서 Supabase를 직접 호출하면 `https://<id>.supabase.co/rest/v1/...` 요청이 네트워크 탭에 다 보임.

```tsx
"use client";

import { createClient } from "@/lib/supabase/client"; // Browser Client

export default function UserProfile() {
  const supabase = createClient();

  // ⚠️ 네트워크 탭에 쿼리 파라미터와 응답 결과가 모두 노출됨
  useEffect(() => {
    supabase.from("users").select("*").then(console.log);
  }, []);

  return <div>Loading...</div>;
}
```
