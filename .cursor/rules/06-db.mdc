---
description: Supabase DB 타입 연동, 스키마 관리 및 데이터 핸들링 규칙
globs: src/types/**/*.ts, src/lib/supabase/**/*.ts, src/hooks/**/*.ts
alwaysApply: true
---

아래의 조건 및 주의사항을 모두 적용하여 코드를 작성할 것.

==============================================

- [타입경로]
  - [DB타입]: src/types/supabase.ts "자동 생성된 파일"

==============================================

1. 타입 정의 조건 (Type Safety)

   - **Generated Types Only:** 테이블에 대한 타입 정의는 개발자가 수동으로 작성(`interface User {...}`)하지 말고, 반드시 \* [타입경로]에 있는 `Database` 타입을 import 하여 사용할 것.
   - **Type Helper:** `Row`, `Insert`, `Update` 헬퍼 타입을 적극 활용할 것.
     - 예: `type Review = Database['public']['Tables']['reviews']['Row']`
   - **No Any:** 데이터 페칭 결과에 `any`를 사용하는 것을 엄격히 금지한다.

2. Supabase 클라이언트 사용 조건

   - **Client Separation:** - 클라이언트 컴포넌트: `createClientComponentClient` (from `@supabase/auth-helpers-nextjs` or latest package)
     - 서버 컴포넌트/Server Actions: `createServerActionClient` (쿠키 처리 포함)
     - 이 둘을 혼용하지 않도록 주의할 것.

3. 에러 핸들링 조건

   - **PostgrestError:** Supabase 요청 실패 시 반환되는 `error` 객체는 `PostgrestError` 타입으로 처리하고, UI에 적절한 메시지(토스트 등)를 띄울 것.
   - **Null Check:** DB에서 `single()` 조회 시 데이터가 없으면 에러가 아닌 `null`을 반환할 수 있음을 고려하여 방어 코드를 작성할 것.

4. 마이그레이션 및 동기화
   - SQL Editor에서 스키마를 변경했다면, 반드시 `npx supabase gen types typescript --project-id ... > src/types/supabase.ts` 명령어를 실행하여 타입을 동기화했다는 가정하에 코드를 작성할 것.
