---
alwaysApply: true
---

# Testy Project Rules

ì•„ë˜ì˜ ì¡°ê±´ ë° ì£¼ì˜ì‚¬í•­ì„ ëª¨ë‘ ì ìš©í•˜ì—¬ ì½”ë“œë¥¼ ì‘ì„±í•  ê²ƒ.

## 1. ê¸°ìˆ  ìŠ¤íƒ ë° í™˜ê²½ (Tech Stack)

- **Framework:** Next.js 16 (App Router, Turbopack)
- **Core Library:** React 19 (RC/Stable)
- **Language:** TypeScript 5.x (Strict Mode)
- **Styling:** Tailwind CSS 4.x (or latest compatible v3.4+)
- **Backend:** Supabase (Auth, DB)
- **State Management (Hybrid Strategy):**
  - **Server State:** TanStack Query v5 (@tanstack/react-query) - API ìºì‹±, ë¬´í•œ ìŠ¤í¬ë¡¤
  - **Client UI State:** Zustand v5 - ëª¨ë‹¬ ì œì–´, ì „ì—­ UI ì„¤ì •
- **i18n:** next-intl

## 2. ìƒíƒœ ê´€ë¦¬ ì›ì¹™ (State Management Rules)

**ê°€ì¥ ì¤‘ìš”í•œ ê·œì¹™ì„.** ë°ì´í„°ì˜ ì„±ê²©ì— ë”°ë¼ ë„êµ¬ë¥¼ ì—„ê²©íˆ êµ¬ë¶„í•œë‹¤.

- **Server Data (API):**
  - ê¸°ë³¸ì ìœ¼ë¡œ **Server Components**ì—ì„œ `fetch`ë¡œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ ë Œë”ë§í•˜ëŠ” ê²ƒì„ 1ìˆœìœ„ë¡œ í•œë‹¤. (ì´ˆê¸° ë¡œë”© ì†ë„ ìµœì í™”)
  - í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ì¸í„°ë™ì…˜(ë¬´í•œ ìŠ¤í¬ë¡¤, ì‹¤ì‹œê°„ í•„í„°ë§, ë‚™ê´€ì  ì—…ë°ì´íŠ¸)ì´ í•„ìš”í•œ ê²½ìš°ì—ë§Œ **TanStack Query** (`useQuery`, `useMutation`)ë¥¼ ì‚¬ìš©í•œë‹¤.
  - `useEffect`ë¡œ APIë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ì—¬ ìƒíƒœì— ë„£ëŠ” í–‰ìœ„ë¥¼ ê¸ˆì§€í•œë‹¤.
- **Client State (UI):**
  - ì•± ì „ì—­ì—ì„œ ê³µìœ ë˜ëŠ” UI ìƒíƒœ(ë¡œê·¸ì¸ ëª¨ë‹¬ ì—´ë¦¼ ì—¬ë¶€, ì‚¬ì´ë“œë°” í† ê¸€ ë“±)ëŠ” **Zustand** Storeë¡œ ê´€ë¦¬í•œë‹¤.
  - ë‹¨ìˆœí•œ ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ ìƒíƒœ(Form ì…ë ¥ê°’ ë“±)ëŠ” `useState`ë¥¼ ì‚¬ìš©í•œë‹¤.

## 3. ì½”ë”© ìŠ¤íƒ€ì¼ ë° ì›ì¹™ (Coding Standards)

- **Next.js 16 / React 19 Patterns:**
  - Server Componentsê°€ ê¸°ë³¸ì´ë©°, `use client` ì§€ì‹œì–´ëŠ” ê¼­ í•„ìš”í•œ ê²½ìš°ì—ë§Œ íŒŒì¼ ìµœìƒë‹¨ì— ì‘ì„±í•œë‹¤.
  - ë°ì´í„° ë³€í˜•(Form Submit ë“±)ì€ **Server Actions**ë¥¼ ìš°ì„  ê³ ë ¤í•œë‹¤.
  - `async/await`ë¥¼ ì‚¬ìš©í•œ Server Componentsì—ì„œì˜ ë°ì´í„° í˜ì¹­ì„ ê¶Œì¥í•œë‹¤.
- **Styling:**
  - Tailwind Utility Classë¥¼ ìš°ì„  ì‚¬ìš©í•œë‹¤. (`styles.module.css` ë“± ë³„ë„ íŒŒì¼ ìƒì„± ê¸ˆì§€)
  - ìƒ‰ìƒì€ `bg-zinc-950`, `text-blue-500` ë“± ì§€ì •ëœ ë””ìì¸ ì‹œìŠ¤í…œ í† í°ì„ ì¤€ìˆ˜í•œë‹¤.
- **Types:**
  - `any` íƒ€ì… ì‚¬ìš©ì„ ì—„ê²©íˆ ê¸ˆì§€í•œë‹¤.
  - DB ìŠ¤í‚¤ë§ˆ íƒ€ì…ì€ Supabaseì—ì„œ ìƒì„±ëœ íƒ€ì…ì„ `import`í•˜ì—¬ ì‚¬ìš©í•œë‹¤.

## 4. í´ë” êµ¬ì¡° (Directory Structure)

ì•„ë˜ êµ¬ì¡°ë¥¼ ì—„ê²©íˆ ì¤€ìˆ˜í•œë‹¤.

### Next.js 16 App Router + next-intl êµ¬ì¡°

```
/src
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/                      # (ì„ íƒ) API Routes
â”‚   â”‚   â””â”€â”€ og/                   # OG Image ìƒì„±ìš©
â”‚   â”œâ”€â”€ auth/                     # ğŸ”´ [ìœ„ì¹˜ ë³€ê²½] locale ë°–ìœ¼ë¡œ ì´ë™
â”‚   â”‚   â””â”€â”€ callback/
â”‚   â”‚       â””â”€â”€ route.ts          # êµ¬ê¸€ ë¡œê·¸ì¸ ì½œë°± ì²˜ë¦¬ (UI ì—†ìŒ)
â”‚   â”œâ”€â”€ [locale]/
â”‚   â”‚   â”œâ”€â”€ (legal)/              # ì•½ê´€ ë“±
â”‚   â”‚   â”œâ”€â”€ admin/
â”‚   â”‚   â”œâ”€â”€ category/
â”‚   â”‚   â”œâ”€â”€ gallery/
â”‚   â”‚   â”œâ”€â”€ mbti/
â”‚   â”‚   â”œâ”€â”€ tarot/
â”‚   â”‚   â”œâ”€â”€ test/                 # í…ŒìŠ¤íŠ¸ ìƒì„¸ í˜ì´ì§€
â”‚   â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”‚   â”œâ”€â”€ page.tsx              # ë©”ì¸ í˜ì´ì§€
â”‚   â”‚   â””â”€â”€ not-found.tsx         # [ì´ë™ ì¶”ì²œ] locale ë‚´ë¶€ë¡œ ë„£ìœ¼ë©´ ë²ˆì—­ëœ 404 ê°€ëŠ¥
â”‚   â”œâ”€â”€ globals.css
â”‚   â”œâ”€â”€ layout.tsx                # Root Layout (html, body)
â”‚   â”œâ”€â”€ robots.ts
â”‚   â””â”€â”€ sitemap.ts
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ features/
â”‚   â”‚   â””â”€â”€ auth/
â”‚   â”‚       â”œâ”€â”€ LoginModal.tsx    # ğŸŸ¢ [ì‹ ê·œ] ë¡œê·¸ì¸ ëª¨ë‹¬
â”‚   â”‚       â””â”€â”€ GoogleBtn.tsx     # ğŸŸ¢ [ì‹ ê·œ] êµ¬ê¸€ ë¡œê·¸ì¸ ë²„íŠ¼
â”‚   â””â”€â”€ layout/
â”‚       â””â”€â”€ Header.tsx            # ë¡œê·¸ì¸ ë²„íŠ¼ì´ ìˆëŠ” í—¤ë”
â”œâ”€â”€ store/                        # (ê¸°ì¡´ í´ë” ìœ ì§€)
â”‚   â””â”€â”€ useAuthStore.ts           # ğŸŸ¢ [ì‹ ê·œ] ëª¨ë‹¬ ìƒíƒœ ê´€ë¦¬
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ supabase/                 # Supabase í´ë¼ì´ì–¸íŠ¸ ì„¤ì •
â”œâ”€â”€ middleware.ts                 # i18n ë° Auth ë¯¸ë“¤ì›¨ì–´
```

### next-intl í•„ìˆ˜ ì„¤ì •

1. **`next.config.ts`**:

```ts
import createNextIntlPlugin from "next-intl/plugin";
const withNextIntl = createNextIntlPlugin("./src/i18n/request.ts");
export default withNextIntl({
  /* config */
});
```

2. **`src/middleware.ts`** (í”„ë¡œì íŠ¸ ë£¨íŠ¸ê°€ ì•„ë‹Œ `src/` í´ë”ì— ìœ„ì¹˜):

```ts
import createMiddleware from "next-intl/middleware";
import { routing } from "./i18n/routing";
export default createMiddleware(routing);
export const config = {
  matcher: ["/((?!api|_next|_vercel|.*\\..*).*)"],
};
```

3. **`src/app/[locale]/layout.tsx`** (Locale ë ˆì´ì•„ì›ƒ):

```ts
import { NextIntlClientProvider } from "next-intl";
import { getMessages } from "next-intl/server";
import { routing } from "@/i18n/routing";

// âš ï¸ í•„ìˆ˜: async í•¨ìˆ˜ë¡œ export
export async function generateStaticParams() {
  return routing.locales.map((locale) => ({ locale }));
}

export default async function LocaleLayout({
  children,
  params,
}: {
  children: React.ReactNode;
  params: Promise<{ locale: string }>; // âš ï¸ Next.js 16: paramsëŠ” Promise íƒ€ì…
}) {
  const { locale } = await params; // âš ï¸ í•„ìˆ˜: await ì‚¬ìš©
  const messages = await getMessages({ locale });

  return (
    <NextIntlClientProvider messages={messages}>
      {children}
    </NextIntlClientProvider>
  );
}
```

4. **`src/app/[locale]/page.tsx`** (í˜ì´ì§€):

```ts
import { routing } from "@/i18n/routing";

// âš ï¸ í•„ìˆ˜: async í•¨ìˆ˜ë¡œ export
export async function generateStaticParams() {
  return routing.locales.map((locale) => ({ locale }));
}

export default async function HomePage({
  params,
}: {
  params: Promise<{ locale: string }>; // âš ï¸ Next.js 16: paramsëŠ” Promise íƒ€ì…
}) {
  const { locale } = await params; // âš ï¸ í•„ìˆ˜: await ì‚¬ìš©
  // ...
}
```

5. **ë£¨íŠ¸ ë ˆì´ì•„ì›ƒ (`src/app/layout.tsx`)**:

   - âš ï¸ locale íŒŒë¼ë¯¸í„°ë¥¼ ë°›ì§€ ì•ŠìŒ (params ì—†ìŒ)
   - âš ï¸ html, body íƒœê·¸ë§Œ í¬í•¨
   - âš ï¸ ì „ì—­ ì„¤ì •(í°íŠ¸, ë©”íƒ€ë°ì´í„° ë“±)ë§Œ ì²˜ë¦¬
   - âš ï¸ `globals.css`ëŠ” `src/app/globals.css`ì— ìœ„ì¹˜í•˜ê³  `import "./globals.css"`ë¡œ import

6. **ì¤‘ìš” ì£¼ì˜ì‚¬í•­**:
   - âš ï¸ `generateStaticParams`ëŠ” ë°˜ë“œì‹œ `async` í•¨ìˆ˜ì—¬ì•¼ í•¨
   - âš ï¸ Next.js 16ì—ì„œ `params`ëŠ” `Promise<{ locale: string }>` íƒ€ì…ì´ë¯€ë¡œ `await params` í•„ìˆ˜
   - âš ï¸ `middleware.ts`ëŠ” `src/` í´ë”ì— ìœ„ì¹˜ (í”„ë¡œì íŠ¸ ë£¨íŠ¸ê°€ ì•„ë‹˜)
   - âš ï¸ `globals.css`ëŠ” `src/app/globals.css`ì— ìœ„ì¹˜
   - âš ï¸ ë£¨íŠ¸ ë ˆì´ì•„ì›ƒê³¼ Locale ë ˆì´ì•„ì›ƒì„ ëª…í™•íˆ ë¶„ë¦¬ (ë£¨íŠ¸ëŠ” html/bodyë§Œ, Localeì€ NextIntlClientProvider)

## 5. GIT ì»¨ë²¤ì…˜ (Conventional Commits)

ì‘ì—… ì™„ë£Œ í›„ ì»¤ë°‹ ë©”ì‹œì§€ëŠ” **í•œêµ­ì–´**ë¡œ ì‘ì„±í•œë‹¤.

- `feat`: ìƒˆë¡œìš´ ê¸°ëŠ¥ ì¶”ê°€ (ì˜ˆ: `feat: ì£¼ìŠ¤íƒ ë“œ ìŠ¤í† ì–´ ì´ˆê¸° ì„¤ì •`)
- `fix`: ë²„ê·¸ ìˆ˜ì • (ì˜ˆ: `fix: ë¬´í•œ ìŠ¤í¬ë¡¤ ì¤‘ë³µ ìš”ì²­ ìˆ˜ì •`)
- `docs`: ë¬¸ì„œ ìˆ˜ì • (ì˜ˆ: `docs: README ì„¤ì¹˜ ê°€ì´ë“œ ì¶”ê°€`)
- `style`: ì½”ë“œ í¬ë§·íŒ… (ì˜ˆ: `style: Tailwind í´ë˜ìŠ¤ ì •ë ¬`)
- `refactor`: ì½”ë“œ ë¦¬íŒ©í† ë§ (ì˜ˆ: `refactor: ì• ë‹ˆë©”ì´ì…˜ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸ ë¶„ë¦¬`)
- `chore`: ì„¤ì • íŒŒì¼ ìˆ˜ì •, íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸ (ì˜ˆ: `chore: next-intl ì—…ë°ì´íŠ¸`)

## 6. ì‘ì—… í”„ë¡œì„¸ìŠ¤ (Workflow)

AIëŠ” ì‘ì—…ì„ ì‹œì‘í•˜ê¸° ì „ì— ë‹¤ìŒ ë‹¨ê³„ë¥¼ ìˆ˜í–‰í•´ì•¼ í•œë‹¤.

1. **ë¶„ì„ (Analyze):** `package.json`ì„ í™•ì¸í•˜ì—¬ Next.js 16 ë° ê´€ë ¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë²„ì „ì„ íŒŒì•…í•œë‹¤.
2. **ê³„íš (Plan):** êµ¬í˜„í•  ê¸°ëŠ¥ì˜ ë‹¨ê³„ë¥¼ step-by-stepìœ¼ë¡œ ì •ë¦¬í•œë‹¤.
3. **êµ¬í˜„ (Implement):** ê³„íšì— ë”°ë¼ ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤.
   - Server Component ìš°ì„  ì›ì¹™ ì¤€ìˆ˜
   - Client ComponentëŠ” ìµœì†Œí™” (`use client`ëŠ” í•„ìš”í•œ ê³³ì—ë§Œ)
   - Server Actionsë¥¼ í†µí•œ ë°ì´í„° ë³€í˜•
4. **ê²€í†  (Review):**
   - ìƒíƒœ ê´€ë¦¬ ë„êµ¬(Zustand vs TanStack Query)ê°€ ì ì ˆíˆ ì‚¬ìš©ë˜ì—ˆëŠ”ì§€ í™•ì¸
   - Server/Client Component ë¶„ë¦¬ê°€ ì ì ˆí•œì§€ í™•ì¸
   - TypeScript íƒ€ì… ì•ˆì •ì„± í™•ì¸ (`any` ê¸ˆì§€)
5. **í™•ì¸ (Verify):**
   - `npm run build`ë¥¼ í†µí•´ ë¹Œë“œ ì˜¤ë¥˜ê°€ ì—†ëŠ”ì§€ í™•ì¸
   - `npm run lint`ë¡œ ì½”ë“œ í’ˆì§ˆ ê²€ì¦

## 7. ì£¼ìš” íŒ¨í„´ ì˜ˆì‹œ

### Server Component (ê¸°ë³¸)

```tsx
// src/app/[locale]/anime/[id]/page.tsx
import { getAnime } from "@/lib/tmdb/api";

export default async function AnimePage({
  params,
}: {
  params: { id: string; locale: string };
}) {
  const anime = await getAnime(params.id);
  return <AnimeDetail anime={anime} />;
}
```

### Client Component (ì¸í„°ë™ì…˜ í•„ìš”ì‹œ)

```tsx
// src/components/features/AnimeList.tsx
"use client";

import { useInfiniteQuery } from "@tanstack/react-query";

export function AnimeList() {
  const { data, fetchNextPage } = useInfiniteQuery({
    queryKey: ["anime"],
    queryFn: fetchAnime,
  });
  // ...
}
```

### Zustand Store (UI ìƒíƒœ)

```tsx
// src/stores/uiStore.ts
import { create } from "zustand";

export const useUIStore = create<UIState>((set) => ({
  isModalOpen: false,
  openModal: () => set({ isModalOpen: true }),
  closeModal: () => set({ isModalOpen: false }),
}));
```

### Server Action (ë°ì´í„° ë³€í˜•)

```tsx
// src/actions/review.ts
"use server";

import { revalidatePath } from "next/cache";

export async function createReview(formData: FormData) {
  const review = await saveReview(formData);
  revalidatePath("/anime/[id]");
  return review;
}
```
